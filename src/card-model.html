<link rel="import" href="../bower_components/polymer/polymer.html">
<dom-module id="card-model">
    <script type="text/javascript" src="data.json"></script>
    <script>
        var CardModel = {
            dataUrl: "cards.json",
            cards: cardJson,
            expansions: new Set(),
            subType1s: new Set(),
            subType2s: new Set(),
            raritys: ["All", "Ex", 0, 1, 2, 3, 4, 5],
            unitTypes: ["All", "Character", "Unit", "Grimoire"],
            init: function() {
              this.expansions.add("All");
              this.subType1s.add("All");
              this.subType2s.add("All");
              for (i in this.cards) {
                var card = this.cards[i];
                this.expansions.add(card.expansion);
                this.subType1s.add(card.subType1);
                this.subType2s.add(card.subType2);
              }
            }
        };
        Polymer({
            is: "card-model",
            attached: function() {
              CardModel.init();
            },
            reformat: function(response) {

                var mycards = {};
                var cards = response.detail.response.Cards;
                console.log("Load cards success!");
                for (i in cards) {
                    // if (i > 10) break;
                    var card = cards[i];
                    if (card.CardId != card.RealID) continue;
                    // console.log(card);
                    mycards[card.CardId] = {
                        cid: card.RealID,
                        sphere: card.Sphere,
                        name: card.Name,
                        expansion: card.Expansion,
                        star: card.Rarity == "EX" ? -1 : card.CardSetRarity,
                        unitType: card.UnitType == "Unnamed" ? "Unit" : card.UnitType,
                        subType1: card.SubType1,
                        subType2: card.SubType2,
                        texts: [card.FlavorText.Text1, card.FlavorText.Text2],
                        stats: {
                            "LV": card.BaseStats.Level,
                            "HP": card.BaseStats.HP,
                            "AT": card.BaseStats.AT,
                            "DF": card.BaseStats.DF,
                            "AGI": card.BaseStats.AGI,
                            "RNG": card.BaseStats.RNG,
                            "LP": card.BaseStats.LP
                        },
                        illustrator: card.Illustrator
                    };

                    var myskill = [];
                    for (s in card.Skills) {
                        if ((s != "Soul" && !s.startsWith("Skill")) || card.Skills[s] == null) continue;
                        var skill = card.Skills[s];
                        var skillInfo = {
                            comment: skill.Comment,
                            kid: skill.Id,
                            name: skill.Name,
                            sp: skill.SP,
                            type: skill.Type
                        }
                        myskill.push(skillInfo);
                    }
                    mycards[card.CardId].skills = myskill;
                }
                console.log("var cardJson ='" + JSON.stringify(mycards) + "';");
                // Polymer.dom(this.root).innerHTML = "aaa";
            }
        });
    </script>
</dom-module>
