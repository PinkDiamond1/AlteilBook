<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/iron-media-query/iron-media-query.html">
<link rel="import" href="../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../bower_components/paper-header-panel/paper-header-panel.html">

<link rel="import" href="card-model.html">
<link rel="import" href="card-info.html">
<link rel="import" href="card-list.html">
<link rel="import" href="card-filter.html">

<dom-module id="alteil-book">

    <template>

    <style include="iron-flex iron-flex-alignment">
        .container {
            @apply(--layout-horizontal);
            @apply(--layout-center-justified);
        }
        card-list {
          text-align: center;
          height: 100%;
          overflow-y: scroll;
          background: linear-gradient(to bottom, black, black 30%, #5a5a5a);
        }
        paper-drawer-panel {
  --paper-drawer-panel-left-drawer-container: {
    background: black;
    background: linear-gradient(to bottom, black, black 30%, #5a5a5a);
  };
}
paper-drawer-panel {
  --paper-drawer-panel-main-container: {
    background: #969696;
background: linear-gradient(to bottom right, #969696, #2f2f2f);
  };
}
    </style>

<card-model></card-model>
    <paper-drawer-panel left-drawer drawer-width="270px">
        <paper-header-panel drawer>
            <card-filter current="{{filter}}"></card-filter>
        </paper-header-panel>
        <paper-header-panel main>
            <div class="container" style="height: 100%">
                <template is="dom-if" if="{{isShowInfo}}">
                <card-info card-id="{{cardId}}"></card-info>
                </template>
    <template is="dom-if" if="{{isShowList}}">
                <card-list card-id="{{cardId}}" filter="{{filter}}" class="flex-auto"></card-list>
                </template>
    </div>
    </paper-header-panel>
    </paper-drawer-panel>
    <iron-media-query query="(min-width: 720px)" query-matches="{{isAtLeast720px}}"></iron-media-query>

    </template>

    <script>
        Polymer({
            is: "alteil-book",

            properties: {
                cardId: {
                    type: Number,
                    reflectToAttribute: true,
                    notify: true,
                    observer: 'checkDomIf',
                    value: -1
                },
                filter: {
                    type: String,
                    notify: true
                },
                isAtLeast720px: {
                    type: Boolean,
                    observer: 'checkDomIf'
                },
                isShowInfo: Boolean,
                isShowList: Boolean
            },
            ready: function() {
              var cardId = window.location.hash;
              this.set('cardId', (cardId != "") ? cardId.substring(1) : -1);
                window.onhashchange = function() {
                  var cardId = window.location.hash;
                  this.set('cardId', (cardId != "") ? cardId.substring(1) : -1);
                }.bind(this);
            },
            checkDomIf: function() {
                if (this.cardId >= 0) {
                   window.location.hash = "#" + this.cardId;
                }
                this.set('isShowInfo', this.cardId >= 0);
                this.set('isShowList', this.isAtLeast720px || this.cardId < 0);
            }
        });
    </script>

</dom-module>
