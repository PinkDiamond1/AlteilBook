<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="card-model.html">

<dom-module id="card-list">
    <template>

    <style>
    .cardThumb {
        width: 75px;
        height: 105px;
        display: inline-block;
        background-image: url(css/images/cardback.png);
        background-position: center;
background-repeat: no-repeat;
background-size: cover;
cursor: pointer;
        margin-left: 8px;
    }
    </style>

    <iron-ajax auto url="cards.json" handle-as="json" on-response="onResponse"></iron-ajax>
    </template>

    <script>


        Polymer({
            is: "card-list",

            properties: {
                cards: {
                    type: Object,
                    value: null
                },
                cardId: {
                    type: Number,
                    reflectToAttribute: true,
                    notify: true
                }
            },
            onResponse: function(response) {
                this.set('cards', response.detail.response.Cards);
                this.initList();
            },
            initList: function() {
                if (this.cards == null) return;
                var cardList = Polymer.dom(this.root);
                var c = 0;
                var isFirst = true;
                for (i in this.cards) {
                  if (this.cards[i].CardId != this.cards[i].RealID) continue;
                    if (c++ > 100) return;
                    var cardId = this.cards[i].CardId;
                    var t = document.createElement("div");
                    t.classList.add("cardThumb");
                    var style = "background-image: url(images/card/" + this.pad(cardId) + ".jpg)";
                    if (isFirst) {
                      style = "margin-top:10px;" + style;
                      isFirst = false;
                    }
                    t.setAttribute("style", style);
                    t.setAttribute("card-id", cardId);
                    cardList.appendChild(t);
                }
            },
            listeners: {
                'tap': 'onSelectCard',
            },
            onSelectCard: function(e) {
                this.set("cardId", e.srcElement.getAttribute("card-id"));
            },
            pad: function(n) {
                return (String(0).repeat(4) + String(n)).slice(String(n).length);
            }
        });
    </script>
</dom-module>
